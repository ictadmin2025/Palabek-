(()=>{"use strict";var e={n:t=>{var o=t&&t.__esModule?()=>t.default:()=>t;return e.d(o,{a:o}),o},d:(t,o)=>{for(var r in o)e.o(o,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:o[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=function(e,t,o){let r=`${e}=${t}; path=/`;if(o){const e=new Date;e.setTime(e.getTime()+60*o*60*1e3),r+=`; expires=${e.toUTCString()}`}document.cookie=r},o=(e,o)=>{let r=e.getAttribute("id");r=r.replace("popup-builder-","");const{entrAnimation:n,exitAnimation:s,animationDuration:i,type:p}=o||{},a=e.querySelector(".popup-builder-container");a.classList.remove(`${n}`),a.classList.add(`${s}`),a.classList.add("reverse"),setTimeout(()=>{["popup","full-screen"].includes(p)&&o?.preventScroll&&(window.parent.document.body.style.overflow=""),e.classList.remove("popup-builder-modal--open"),a.classList.remove(`${s}`),a.classList.remove("reverse"),t(`pbb_closed_${r}`,"true",8760),window.frameElement&&window.frameElement.remove()},1e3*i)},r=function(e){const t=`; ${document.cookie}`.split(`; ${e}=`);return 2===t.length?t.pop().split(";").shift():null},n=window.wp.apiFetch;var s=e.n(n);const i=(e,o)=>{e&&!r(`pbb_conversion_${o}`)&&((e,t)=>{const o=Number(sessionStorage.getItem("pbb_logs"));location.search.includes("iframe=true")&&s()({path:"/pbb/v1/popup/logs",method:"PUT",data:{id:o,...e}}).then(e=>{t&&t(e)})})({converted:!0,refferer:window.parent.document.referrer},e=>{"success"===e.status?t(`pbb_conversion_${o}`,"true",8760):console.error("Error updating conversion count:",e.message)})},p=e=>{const t=JSON.parse(e.getAttribute("data-settings"));return{popupID:e.getAttribute("id").replace("popup-builder-",""),popupAttributes:t}},a=/^(mailto:)?[a-z0-9._%+-]+@[a-z0-9][a-z0-9.-]*\.[a-z]{2,63}$/i;function c(e){return a.test(e)}const l=/^(tel:)?(\+)?\d{6,15}$/;function u(e){return e=e.replace(/[-.() ]/g,""),l.test(e)}const d=window.wp.hooks;var m;m="form",window.addEventListener("load",()=>{window[`__POPUPKIT_${m.toUpperCase()}_INIT`]||(window[`__POPUPKIT_${m.toUpperCase()}_INIT`]=!0,(()=>{const e=document.querySelectorAll(".pbb-form");if(!e.length)return;const t=document.querySelector('[data-block="popup-builder-block/coupon-wheel"]'),n=document.querySelector('[data-block="popup-builder-block/step"]');for(const a of e){const e=a.querySelector('input[type="email"]'),l=a.querySelector('input[type="tel"]'),m=a.querySelector(".pbb-form__submit-btn"),y=JSON.parse(a.getAttribute("data-settings")),{action:f,redirectURL:w,email:v,phone:h,copyText:g,newWindowURL:S,closeCampaign:_,istrackConversion:C,integration:q,message:$,closeCampaignDelay:k=3,step:x}=y||{},I=a.closest(".popup-builder-modal"),{popupID:T,popupAttributes:E}=p(I),L=Array.from(a.querySelectorAll("[required]")),A=e=>e.closest(".pbb-form__field").querySelector(".error-message"),K=(e,t)=>{const o=document.createElement("div");o.classList.add("error-message"),o.textContent=t,e.parentElement.insertAdjacentElement("afterend",o)},P=(e,t,o)=>{const r=t(e.value),n=A(e);r?n&&n.remove():(n||K(e,`Please enter a valid ${o}`),e.focus())};a.addEventListener("submit",async p=>{p.preventDefault();for(const e of L){const t=A(e);if(e.value)t&&t.remove();else{if(t)continue;K(e,"This field is required"),e.focus()}}if(e&&P(e,c,"email"),l&&P(l,u,"phone number"),a.querySelector(".error-message"))return;const O=document.createElement("span");O.classList.add("pbb-form-loader"),m.append(O),m.querySelector(".btn-text").style.opacity=0;const N=new FormData(a,m),D={popup_id:T,form_data:{},user_data:r("pbb_user_info")||{}};for(const[e,t]of N)"email"!==e&&"name"!==e?D.form_data[e]=t.trim():D[e]=t.trim();let U=!1;if(q){if(q?.mailchimp){const{apiKey:e,listId:t,doubleOptin:o}=q.mailchimp;D.mailchimp={apiKey:e,listId:t,doubleOptin:o},U=!0}if(q?.fluentCRM){const{apiKey:e}=q.fluentCRM;D.fluentCRM={apiKey:e},U=!0}if(q?.activeCampaign){const{apiKey:e,listId:t}=q.activeCampaign;D.activeCampaign={apiKey:e,listId:t},U=!0}if(q?.zapier){const{apiKey:e,listId:t}=q.zapier;D.zapier={apiKey:e,listId:t},U=!0}if(q?.hubspot){const{apiKey:e,listId:t}=q.hubspot;D.hubspot={apiKey:e,listId:t},U=!0}if(q?.pabbly){const{apiKey:e}=q.pabbly;D.pabbly={apiKey:e},U=!0}if(q?.aweber){const{apiKey:e}=q.aweber;D.aweber={apiKey:e},U=!0}}if(U&&(D.third_party_integration=!0),"true"===sessionStorage.getItem(`pbb_submitted_${T}`))return m.querySelector(".pbb-form-loader").remove(),m.querySelector(".btn-text").style.opacity=1,a.querySelector(".pbb-form-success")?.remove(),void K(m,"You have already submitted this form.");let z=null;t&&((0,d.doAction)("popup.triggerSpinWheel",!0),z=await new Promise(e=>{(0,d.addAction)("popup.wheelSpinCompleted","pbb/spinCompleteHandler",t=>{e(t),(0,d.removeAction)("popup.wheelSpinCompleted","pbb/spinCompleteHandler")})}));const M=(0,d.applyFilters)("popup.wheelCouponCode",null,!0);z&&!n&&b(".wp-block-popup-builder-block-form",`\n\t\t\t\t\t<div class="popup-builder-coupon-wheel-result">\n      \t\t\t\t\t<h1 class="popup-builder-coupon-wheel-title">${M?.success?.wheelSuccessMessage}</h1>\n      \t\t\t\t\t<p class="popup-builder-coupon-wheel-description">${M?.success?.wheelSuccessDescription}</p>\n      \t\t\t\t\t<div class="popup-builder-coupon-code-wrapper">\n      \t\t\t\t\t\t<span class="popup-builder-coupon-code-label">${M?.success?.wheelCouponCodeLabel}</span>\n        \t\t\t\t\t<span class="popup-builder-coupon-code-text">${M?.couponCode}</span>\n      \t\t\t\t\t</div>\n    \t\t\t\t</div>\n \t\t \t\t\t`);const F=()=>{switch(f){case"redirect-url":window.location.href=w;break;case"email":window.location.href=`mailto:${v}`;break;case"call":window.location.href=`tel:${h}`;break;case"copy-text":navigator.clipboard.writeText(g);break;case"new-window":window.open(S,"_blank");break;case"step":const e=(0,d.applyFilters)("popupkit.steps.form",""),t=document.querySelectorAll(".wp-block-popup-builder-block-step");for(const e of t)e.classList.contains("active")&&e.classList.remove("active");const o=e[parseInt(x)];if(o.classList.add("active"),n&&n){const e=document.createTreeWalker(o,NodeFilter.SHOW_TEXT,null,!1);for(;e.nextNode();){const t=e.currentNode;t.nodeValue.includes("{{coupon_code}}")&&(t.nodeValue=t.nodeValue.replace("{{coupon_code}}",M?.couponCode))}}document.querySelector(".popupkit-steps-inner").insertBefore(o,t[parseInt(y.step)])}};if(location.search.includes("iframe=true"))s()({path:"/pbb/v1/subscribers",method:"POST",body:JSON.stringify(D)}).then(e=>{m.querySelector(".pbb-form-loader").remove(),m.querySelector(".btn-text").style.opacity=1;const t=window.getComputedStyle(m).getPropertyValue("position"),r=document.createElement("div");r.className="pbb-form-success",r.textContent=$,"absolute"===t?a.querySelector(".pbb-form__field-0").append(r):m.parentElement.append(r),sessionStorage.setItem(`pbb_submitted_${T}`,"true"),a.reset(),m.disabled=!0,_&&setTimeout(()=>{o(I,E)},1e3*k),i(C,T),F()});else{m.querySelector(".pbb-form-loader").remove(),m.querySelector(".btn-text").style.opacity=1;const e=window.getComputedStyle(m).getPropertyValue("position"),t=document.createElement("div");t.className="pbb-form-success",t.textContent=$,"absolute"===e?a.querySelector(".pbb-form__field-0").append(t):m.parentElement.append(t),a.reset(),m.disabled=!0,_&&setTimeout(()=>{o(I,E)},1e3*k),F()}})}})())});const b=(e,t)=>{const o=document.querySelector(e);if(!o)return;const r=document.createElement("div");r.innerHTML=t.trim(),o.innerHTML="",Array.from(r.childNodes).forEach(e=>{o.appendChild(e)});const n=document.querySelector(".popup-builder-coupon-code-wrapper");n?.addEventListener("click",()=>{const e=n.querySelector(".popup-builder-coupon-code-text"),t=e.textContent;(async e=>{try{await navigator.clipboard.writeText(e)}catch{const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.select();try{document.execCommand("copy")}catch(e){console.error("Copy failed",e)}document.body.removeChild(t)}})(t).then(()=>{e.textContent="COPIED!",setTimeout(()=>e.textContent=t,3e3)})})}})();